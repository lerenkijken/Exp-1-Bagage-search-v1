
<!DOCTYPE html>
<html>
  <head>
    <title>Exp 1 - Bagage search</title>
    <!-- Get all the required libraries -->
    <script src="https://unpkg.com/jspsych@8.2.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-button-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-slider-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-instructions@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
        <script src="https://unpkg.com/@jspsych/plugin-canvas-keyboard-response@1.1.3"></script>
    
    <script src="fabric.js"></script> 
    <link href="https://unpkg.com/jspsych@8.2.2/css/jspsych.css" rel="stylesheet" type="text/css" />  
    
  </head>
  <body></body>
  <script>

    //Initialize jsPsysch
    const jsPsych = initJsPsych({
        // show_progress_bar: true,
        // message_progress_bar: 'Progress',
        on_finish: function() {
            jsPsych.data.displayData('json');
        }

    });


    // participant & exp info
    // later use this: "let urlvars = jsPsych.data.urlVariables()" "
    let urlvars = {
        uid: jsPsych.randomization.randomID(10),
        token: jsPsych.randomization.randomID(15),
        exp_id:'Exp-1-bagage'
    } 


    jsPsych.data.addProperties({
        uid: urlvars.uid,
        token: urlvars.token,
        exp_id: urlvars.exp_id,
    });

    // trial parameters
    const person_presentation_time = 1000
    const grid_presentation_time = 5000
    const canvas_w = 500
    const canvas_h = 500
    const obj_scale = 0.6 // makes objects around 100 pix in size
    const canvas_size = [canvas_w,canvas_h]
    const n_objects = 6
   
    const stims = [
    'doodle icons/PNG/food/burger.png',
    'doodle icons/PNG/food/cake.png',
    'doodle icons/PNG/food/candy.png',
    'doodle icons/PNG/food/cutlery.png',
    'doodle icons/PNG/food/dish.png',
    'doodle icons/PNG/food/drink.png',
    'doodle icons/PNG/food/egg.png',
    'doodle icons/PNG/food/fork.png',
    'doodle icons/PNG/food/ice-cream.png',
    'doodle icons/PNG/food/pizza-2.png',
    'doodle icons/PNG/food/pizza.png',
    'doodle icons/PNG/food/popsicle.png',
    'doodle icons/PNG/food/spoon.png',
    'doodle icons/PNG/food/water.png',
    ]

    // make fabric objects of the stimuli
    let fabric_imgs = []
    stims.forEach(img_src => {
        let Img = new Image();
        Img.src = img_src;

        let fabric_img = new fabric.Image(Img, {selectable:false, hoverCursor:'auto'})//
        fabric_imgs.push(fabric_img)
    });


    const preload = {
        type: jsPsychPreload,
        images: stims,
    }


function make_trial() {


      let fabric_trial = {
        type: jsPsychCanvasKeyboardResponse,
        canvas_size: canvas_size,
        trial_duration: null,
        stimulus: function (c) {

            fabric_imgs = jsPsych.randomization.shuffleNoRepeats(fabric_imgs)
            
            // initialize canvas and timestamp
            timestamp=performance.now()
            let canvas = new fabric.Canvas("jspsych-canvas-stimulus", {backgroundColor:'cyan', selection:false});
            canvas.on('mouse:down', function(options) {
                    console.log(options.e.layerX, options.e.layerY);
                    circle = new fabric.Circle({
                        radius: 10, fill: 'red', left: options.e.layerX-10, top: options.e.layerY-10, selectable:false, hoverCursor:'auto'
                        });
                    canvas.add(circle)
                });
                
    
        
            // add a bunch of objects in  the briefcase 
            for (let i=0; i<stims.length; i++){
            let obj = fabric_imgs[i]
            obj.scaleX = obj_scale
            obj.scaleY = obj_scale

            obj.left = Math.random()*(canvas_w - obj.width*obj_scale)
            obj.top = Math.random()*(canvas_h - obj.height*obj_scale)
            canvas.add(obj)
            }  
            canvas.renderAll()
          
        },      
        choices: 'ALL_KEYS',

        on_finish:(data) => { 

        }
      } 

      return fabric_trial
    }

    // build trial sequence:
    const intro = {
        type: jsPsychHtmlButtonResponse,
        stimulus: "<h3>Welkom! </h3>"+
        "</p>",
        choices: ["<p>Begin!</p>"],
        data:{
            label:'intro',
        }
    };

    let all_indices = [...Array(13).keys()]
    let crowd_indices = jsPsych.randomization.sampleWithoutReplacement(all_indices, 6)
   
    

    let timeline = [preload, make_trial()]


    
    jsPsych.run(timeline);   

  </script>
</html>



